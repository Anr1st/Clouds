# –û—Ç—á—ë—Ç –ø–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ2
## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?
–ù–∞—à–µ –∑–∞–¥–∞—á–µ–π –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ "–ø–ª–æ—Ö–æ–≥–æ" –∏  "—Ö–æ—Ä–æ—à–µ–≥–æ" Dockerfile. –í –ø–µ—Ä–≤–æ–º –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–≤–∏—Ç—å –Ω–µ –º–µ–Ω–µ–µ —Ç—Ä—ë—Ö "bad practices", –Ω—É –∞ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º "—Ö–æ—Ä–æ—à–µ–º" - –ø–æ—Ñ–∏–∫—Å–∏—Ç—å. 

–†—É–±—Ä–∏–∫–∞: "–æ–±—ä—è—Å–Ω—è–µ–º –Ω–∞ –∫–æ—Ç—è—Ç–∞—Ö"üêà

![cat](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/cat2.jpg)

## Latest
‚ùå–ß—Ç–æ–∂ –∂, –Ω–∞—á–Ω–µ–º, –ø–æ–∂–∞–ª—É–π, c –æ—á–µ–≤–∏–¥–Ω–æ–≥–æ:
```FROM python:latest```

–í –ø–ª–æ—Ö–æ–º Dockerfile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞–∑ —Å —Ç–µ–≥–æ–º latest. 
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –±–∏–ª–¥–µ –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è —Å–∞–º–∞—è 
—Å–≤–µ–∂–∞—è –≤–µ—Ä—Å–∏—è Python, –∏ –æ–Ω–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, 
—Å–µ–≥–æ–¥–Ω—è —É –Ω–∞—Å –≤—Å–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä—É—Ç–æ, –∞ –∑–∞–≤—Ç—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 
–ø–æ–ª–æ–º–∞–µ—Ç –≤—Å–µ, —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –ø–æ—Ç–æ–º –∏ –∫—Ä–æ–≤—å—é, —Å–ª–æ–º–∞–≤ –ª–æ–≥–∏–∫—É.

‚úÖ–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å? –ê –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∏ –º–µ–Ω–µ–µ –±–æ–ª—å—à—É—é –≤–µ—Ä—Å–∏—é, —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –±–∏–ª–¥–∞ Dockerfileüëç

```FROM python:3.10-slim```

## –ù–µ—Å–∫–æ–ª—å–∫–æ RUN
‚ùå
```
RUN apt-get update
RUN apt-get install -y curl
RUN pip install flask
```
–ù—É –∏ –¥–µ–ª–∞–∞... –£–≤—ã, —Å –≤–∏–¥—É –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–π –ø–æ–¥—Ö–æ–¥, —Å–æ–∑–¥–∞–µ—Ç –º–Ω–æ–≥–æ 
—Å–ª–æ–µ–≤ –≤ –æ–±—Ä–∞–∑–µ, —á—Ç–æ, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –µ–≥–æ —Ä–∞–∑–º–µ—Ä –∏ 
–∑–∞—Ö–ª–∞–º–ª—è–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. 

‚úÖ
"–ß—Ç–æ –∑–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ?" - —Å–ø—Ä–æ—Å–∏—Ç–µ –í—ã. –ê —è –æ—Ç–≤–µ—á—Éü´°
```
RUN apt-get update && apt-get install -y --no-install-recommends curl \
     && rm -rf /var/lib/apt/lists/*
```
–í—ã–≥–ª—è–¥–∏—Ç –º–µ–Ω–µ–µ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –∑–∞—Ç–æ –ø–æ–ª—å–∑—ã —Å–∏–ª—å–Ω–æ –±–æ–ª—å—à–µ! –ú—ã —Å—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã, –æ—á–∏—â–∞–µ–º –∫—ç—à –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ, —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–∞–∫–µ—Ç—ã ```--no-install-recommends``` –∏ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ ```rm -rf /var/lib/apt/lists/*```.

## –ß—Ç–æ —Ç–∞–º —Å root-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º?
‚ùå–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç root(–≤ –Ω–∞—à–µ–º "–ø–ª–æ—Ö–æ–º" Dockerfile –Ω–∏—á–µ–≥–æ –Ω–µ—Ç –ø—Ä–æ —é–∑–µ—Ä–∞, so..), —á—Ç–æ –Ω–µ—Å–µ—Ç –∑–∞ 
—Å–æ–±–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≥—Ä–æ–∑–Ω—ã–π –¥—è–¥—å–∫–∞ 
–∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –æ–Ω —Å—Ä–∞–∑—É 
–æ–∫–∞–∂–µ—Ç—Å—è root –∏ —É –Ω–µ–≥–æ –±—É–¥–µ—Ç –≤—Å—è –≤–ª–∞—Å—Ç—å –¥–ª—è –∞—Ç–∞–∫–∏ 
—Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—ãüòà

‚úÖ–ù–æ –º—ã —Ä–µ–±—è—Ç–∞ —É–º–Ω—ã–µ, –ø–æ—ç—Ç–æ–º—É –≤ "—Ö–æ—Ä–æ—à–∏–π" Dockerfile –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ```appuser```, –∏ —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ç –µ–≥–æ –∏–º–µ–Ω–∏! –≠—Ç–æ –ø–æ–≤—ã—Å–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

```RUN useradd -m appuser```

```USER appuser```

![cat](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/cat%20krutoi.jpg)

*–≥—Ä–æ–∑–Ω—ã–π –¥—è–¥—å–∫–∞ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫*

## COPY
‚ùå–í—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ—Ç —É–∂–∞—Å?
```COPY . .```

–ë—É–∫–≤–∞–ª—å–Ω–æ, –∫–æ–ø–∏—è –≤—Å–µ–≥–æ –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏—è..–í—Å–µ –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã. –ó–∞—á–µ–º –Ω–∞–º —ç—Ç–æ—Ç –º—É—Å–æ—Ä?


‚úÖ–ú—ã –∫–æ–ø–∏—Ä—É–µ–º —Å–Ω–∞—á–∞–ª–∞ ```requirements.txt```, –∞ –ø–æ—Ç–æ–º —É–∂–µ ```app.py```. 

```
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app.py .
```
–ó–∞–æ–¥–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—è–µ–º ```--no-cache-dir```, —á—Ç–æ–±—ã —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –º–µ—Å—Ç–æ.

## –ß—Ç–æ –≤ –∏—Ç–æ–≥–µ?
–ê –≤ –∏—Ç–æ–≥–µ, "–ø–ª–æ—Ö–æ–π" Dockerfile - –ª–∞–∂–∞ –ø–æ–ª–Ω–∞—è. –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –±–æ–ª—å—à–æ–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–ª–∞–±–∞—è –∏ –æ–Ω –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –≤ "—Ö–æ—Ä–æ—à–µ–º" Dockerfile —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ—Ç–µ, –∏ –æ–Ω –±—ã—Å—Ç—Ä—ã–π, –∫–∞–∫ –º–æ–ª–Ω–∏—è –º–∞–∫–≤–∏–Ω.



![–õ–∏—Å—Ç–∏–Ω–≥ Dockerfile.bad](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/1.1.png)

*–õ–∏—Å—Ç–∏–Ω–≥ Dockerfile.bad*

![–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã Dockerfile.bad](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/1.png)
*–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã Dockerfile.bad*

![–õ–∏—Å—Ç–∏–Ω–≥ Dockerfile.good](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/2.1.png)
*–õ–∏—Å—Ç–∏–Ω–≥ Dockerfile.good*

![–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã Dockerfile.good](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/2.png)
*–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã Dockerfile.good*

## –î–≤–µ –ø–ª–æ—Ö–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫–∏

1. –ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: –µ—Å–ª–∏ –≤—ã –∑–∞–±—ã–≤–∞–µ—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –æ–Ω–∏ –º–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∏–∑–±—ã—Ç–æ—á–Ω–æ–º—É –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ docker stop –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–Ω—É–∂–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ docker rm –¥–ª—è –∏—Ö —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏. 

2. –°–µ—Ç–µ–≤—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã: –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ç–µ–π –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω –∏ –ø–æ—Ä—Ç–æ–≤. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç—ã –∏ —Å–µ—Ç–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ. (–°–ø–∞—Å–∏–±–æ –∫—É—Ä—Å—É –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏ –≤ –ø–µ—Ä–≤–æ–º —Å–µ–º–µüõú)

# –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! 
![cat](https://github.com/Anr1st/Clouds/blob/main/lab-2/photos/cat1.1.jpg)
